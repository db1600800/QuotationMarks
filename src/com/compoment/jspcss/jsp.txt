<%@ page language="java" import="java.util.*" contentType="text/html;charset=UTF-8" isELIgnored="false" %>
<%@ taglib prefix="s" uri="/struts-tags" %>   
<<<<<<< Updated upstream
<%@ page import="java.util.*"%>

<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>修改密码</title>
<link href="/chinapost/jiyouwx/css/css.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="/chinapost/jiyouwx/js/jquery-1.10.1.min.js"></script>
<script type="text/javascript">
function onBridgeReady(){
	 WeixinJSBridge.call('hideOptionMenu');
}
if (typeof WeixinJSBridge == "undefined"){
   if( document.addEventListener ){
       document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
   }else if (document.attachEvent){
       document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
       document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
   }
}else{
   onBridgeReady();
}
</script>
<script>
var click_once = true;
function save(){
	if(click_once == false){
		return; 
	}

	var oldPassword = $("#oldPassword").val();
	oldPassword = oldPassword.replace(/\s/ig,'');
	var newPassword = $("#newPassword").val();
	newPassword = newPassword.replace(/\s/ig,'');
	var newPassword2 = $("#newPassword2").val();
	newPassword2 = newPassword2.replace(/\s/ig,'');

	if(oldPassword == ""){
		auto_msg("请输入原密码！");
		return;
	}

	if(newPassword == "" ){
		auto_msg("请输入新密码！");
		return;
	}

	if(newPassword.length<6 ){
		auto_msg("密码长度需大于等于6位！");
		return;
	}

	if(newPassword2 == "" ){
		auto_msg("请再次输入新密码！");
		return;
	}

	if(newPassword2 != newPassword ){
		auto_msg("两次输入的新密码不一致！");
		return;
	}

	click_once = false;
	var my_msg = show_hide_msg("数据提交中，请稍候...");
	var myform = document.forms[0]; 
   	myform.action='/jiyou/wx/MemberAction!changePassword.do?';  
   	myform.submit();
   	my_msg = null;
}

function changePwSuccess(){
	var my_msg = show_hide_msg("页面跳转中，请稍候...");
   window.location.href = "/jiyou/wx/MemberAction!init.do?";
   my_msg = null;
}
</script>
</head>
<body>
<form action="" id="changePw"  method="post">
<header><img src="/chinapost/jiyouwx/images/back.png" onclick="window.location.href='/jiyou/wx/MemberAction!init.do';" class="back">修改密码</header>
<div class="h45">&nbsp;</div>
<ul class="box03 ul01 ul02">
<li><strong class="red">*</strong>旧密码：
  <input type="password" class="input01" id="oldPassword" name="oldPassword" maxlength="20" placeholder="请输入原密码"></li>
<li><strong class="red">*</strong>新密码：
  <input type="password" class="input01" id="newPassword" name="newPassword" maxlength="12" placeholder="请输入新密码">
  </li>
<li><strong class="red">*</strong>重复密码：
  <input type="password" class="input01" id="newPassword2" maxlength="12" placeholder="请再次输入新密码">
  </li>

</ul>
<a href="#" class="btn02" onclick="save()">保存</a>

<jsp:include page="/chinapost/jiyouwx/global_error.jsp"></jsp:include>
</form>

=======
<%@page import="java.util.*"%>
<%@ page import="com.chinapost.weixin.common.CommonFunction"%>
<%
    response.setHeader("Cache-Control","no-cache");
    response.setHeader("Pragma","no-cache");
    response.setDateHeader ("Expires", -1);
%>
<!DOCTYPE HTML> 
<html>
<head>
<meta charset='utf-8'>
<meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, ">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<META Http-Equiv="Cache-Control" Content="no-cache"/>
<META Http-Equiv="Pragma" Content="no-cache"/>
<META Http-Equiv="Expires" Content="-1"/>
<title>地址管理</title>

<link href="/chinapost/jiyouwx/css/css.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="/chinapost/jiyouwx/js/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="/chinapost/jiyouwx/js/swiper-2.1.min.js"></script>
<script type="text/javascript" src="/chinapost/jiyouwx/js/jy/shopcart.js?v=1.1.2" charset='utf-8'></script>
<%-- 统一错误处理 --%>
<%@include file="/chinapost/jiyouwx/global_error.jsp"%>
	<style type="text/css">
	.checkbox_sty {
		visibility:hidden;
	}
	</style>
</head>
<body>
<header><img src="/chinapost/jiyouwx/images/back.png" onclick="history.go(-1);" class="back">收货地址</header>
<div class="h45">&nbsp;</div>

<div id="form1_pageset"></div>

<div id="noMsg"></div>
<a href="#" class="btn04" onclick="addAddress()"><strong>+ </strong>添加新地址</a>

<input type="hidden" id="flag" name="shoppingCar" value="<%=request.getAttribute("shoppingCar") %>">

<script type="text/javascript">
function deleteAddress(id){
	confirm_msg('确认删除本条地址信息？', function(yes) {
        if (yes) {
			window.location.href = "/jiyou/wx/AddressAction!deleteAddress.do?id="+id+"&shoppingCar="+$("#flag").val();	
        } else { }
	});
}

function addAddress(){
	var max_num = <%=CommonFunction.readDefVal("max_address_num")%>;
	
	if(curr_addr >= max_num){
		alert_msg("您的收货地址数量已经达到最大数量"+max_num+"条，请先删除现有地址后再添加！");  
		return;
	}
	var flag = $("#flag").val();
	var my_msg = show_hide_msg("数据提交中，请稍候...");
	window.location.href = "/jiyou/wx/AddressAction!addAddress.do?shoppingCar="+flag;
	my_msg = null;
}

var stop=false;
$(window).scroll(function(){
    var totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop());
    if($(document).height() <= totalheight){
        if(stop==true){
            stop=false;
            query_ajx(1);
        }
    }
});

$(document).ready(function() {
	//查询订单列表
	query_ajx(0);
});

var curr_addr = 0; //当前地址的数量
var only_one_sub = true; //防重复提交
function query_ajx(flg){ 
	  
    if(!only_one_sub){
        return;//防重复提交
    }  
    only_one_sub = false;//防重复提交
   
    if(flg == 0){//按查询时
    	$("#page_code").val(1);			    	
    }		    
   
    curr_addr = 0;

    var flag = $("#flag").val();
    var my_msg = show_hide_msg("页面加载中...");
    $("#noMsg").html("");
    $.ajax({  
        url:'/jiyou/wx/AddressAction!queryAddressList.do?',  
        data: { "page_code": $("#page_code").val()} ,  
        type:"POST",
        cache:false, 
        dataType:'json', //预期服务器返回的数据类型  
        error: function() {
        	only_one_sub = true;  ////防重复提交
        	alert_msg("查询出错了!!!"); 
   			$("#form1_pageset").html(""); 
   			$("#noMsg").html("");
   			my_msg.close();
   			curr_addr = 0;
        },  
        success:function(data){
          my_msg.close();
        	if (data != null){
        		var msg = data.result;
     		    if(msg == "success"){
     		    	
         		    var rlt = data.rltdata.redo;
         		    curr_addr = rlt.length;

	        		if(flg == 0){//按查询时
	        			 $("#form1_pageset").html("");				    	
	     		    }
	            	var opt = "";
					for(var i=0;i<rlt.length;i++){
						opt += '<div class="box05"><table width="100%" border="0" cellspacing="0" cellpadding="0" class="cfTable"><tr class="tr01">';
						if(flag == "1"){//表示从购物车页面进入
							var param = "recvName="+rlt[i].recvName+"&provCode="+rlt[i].provCode+"&cityCode="+rlt[i].cityCode+"&countCode="+rlt[i].countCode+
							"&detailAddress="+rlt[i].detailAddress+"&mobileNo="+rlt[i].mobileNo+"&postCode="+rlt[i].postCode+"&addressID="+rlt[i].addressID;

							if(rlt[i].isDefaultAddress == '0' ){
								opt += '<td><dd onclick="selectAddress(this, \''+ param+'\')" class="checked04"><input type="checkbox" name="addressID_box" class="checkbox_sty" value="'+ rlt[i].addressID +'" checked="checked"/>默认地址</dd></td>';
							}else{
								opt += '<td><dd onclick="selectAddress(this, \''+ param+'\')" class="check04"><input type="checkbox" name="addressID_box" class="checkbox_sty" value="'+ rlt[i].addressID +'" />选择该地址</dd></td>';
							}
						}else{ //表明从会员首页点击"我的地址"进入
							if(rlt[i].isDefaultAddress == '0' ){
								opt += '<td >默认地址</td>';
							}else{
								opt += '<td ></td>';
							}
							
						}
						opt += '<td width="60"><a  href="#" class="del02" onclick="deleteAddress(\''+rlt[i].addressID+'\')">删除</a></td>';
						opt += ' </tr><tr><td><p class="p01">收货人：'+rlt[i].recvName+'&nbsp;&nbsp;&nbsp;&nbsp;'+rlt[i].mobileNo+'</p>';
						opt += '<p class="p02">'+rlt[i].totalAddress+'&nbsp;&nbsp;&nbsp;&nbsp;'+rlt[i].postCode+'</p></td>';
						opt += '</tr></table></div>';
					}

					$("#page_code").val(Number($("#page_code").val()) + 1);		
	
					if(rlt.length >= 10){
		        		stop = true;//到底部时加载判断
		        	} 
		        	if(rlt.length == 0){
          				$("#noMsg").html('<br><br><br><br><div style="text-align:center;">暂无地址信息</div>');
	            	}
		        	$(opt).appendTo($("#form1_pageset"));
	        		
			   		only_one_sub = true;  ////防重复提交
	        	}else{
	        		only_one_sub = true;  ////防重复提交
	       			$("#form1_pageset").html("");  
	       			alert_msg(msg);
	       			$("#noMsg").html("");
	        	}
        	}
        }  
    });
}

</script>
>>>>>>> Stashed changes
</body>

</html>